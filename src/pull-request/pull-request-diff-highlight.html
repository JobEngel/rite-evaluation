<!-- <!doctype html> -->
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/prism-element/prism-highlighter.html">
<link rel="import" href="../bower_components/prism-element/prism-style-import.html">

<dom-module id='pull-request-diff-highlight'>
  <template>
    <style is="custom-style" include="prism-styles"></style>
    <style>
      pre {
        padding: 0;
        margin: 0;
      }
    </style>

      <prism-highlighter></prism-highlighter>
      <pre>
        <code id="output"></code>
      </pre>

  </template>

  <script>
    Polymer({
      is: 'pull-request-diff-highlight',

      properties: {
        code: {
          type: String,
          observer: '_render'
        },
        lang: {
          type: String
        }
      },
      attached: function() {
        this._render();
      },
      _render: function() {
        if (!this.isAttached) {
          return;
        }
        this.async(function() {
          Polymer.dom(this.$.output).innerHTML = this.highlight(this.code, this.lang);
        });
      },
      highlight: function(code, lang) {
        var code = code.replace('\n', '<br />');
        var event = this.fire('syntax-highlight', {code: code, lang: 'diff'});
        return event.detail.code || code;
      }
    });
  </script>


</dom-module>
