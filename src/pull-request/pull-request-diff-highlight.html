<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../util/collapse-icon.html">

<dom-module id='pull-request-diff-highlight'>
  <template>
    <style is="custom-style" include="prism-styles"></style>
    <style>
      :host {
        display: block;
        margin: 1em 0;
        overflow: hidden;
        padding: 1em 2em;
        -webkit-transition: all 0.3s ease;
        -moz-transition: all 0.3s ease;
        -ms-transition: all 0.3s ease;
        -o-transition: all 0.3s ease;
        transition: all 0.3s ease;
      }
      header {
        background-color: var(--secondary-background-color);
        padding: 0.5em;
      }
      pre {
        padding: 0;
        margin: 0;
        line-height: 10px;
        padding: 1em;
        overflow-x: auto;
      }
      pre span {
        font-size: 12px;
        height: 18px;
        width: 100%;
        display: inline-block;
      }
      .token.inserted {
        background-color: var(--addition-color);
        color: inherit;
      }
      .deleted {
        background-color: var(--deletion-color);
      }
      :host([collapsed]) {
        height: 1em;
      }
    </style>

    <header>
      [[file]]
      <collapse-icon collapsed="{{collapsed}}"></collapse-icon>
    </header>
    <pre>
      <code id="output"></code>
    </pre>
  </template>

  <script>
    Polymer({
      is: 'pull-request-diff-highlight',

      properties: {
        code: {
          type: String,
          observer: '_render'
        },
        collapsed: {
          type: Boolean,
          reflectToAttribute: true
        },
        file: String,
      },
      attached: function() {
        this._render();
      },
      _render: function() {
        if (!this.isAttached) {
          return;
        }
        this.async(function() {
          Polymer.dom(this.$.output).innerHTML = this.highlight(this.code);
        });
      },
      highlight: function(code) {
        var event = this.fire('syntax-highlight', {code: code, lang: 'diff'});
        return event.detail.code || code;
      }
    });
  </script>


</dom-module>
