<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../util/marked-github-element.html">

<dom-module id="markdown-input">
  <template>
    <style>
      :host {
        display: block;
        padding: 1em;
        border: solid 1px transparent;
      }
      :host([disabled]) {
        border: 0;
        background-color: transparent;
      }
      :host(.noPreview) {
        border: solid 1px var(--secondary-background-color);
        background-color: var(--tertiary-background-color);
      }
      [hidden] {
        display: none !important;
      }
      paper-textarea,
      marked-github-element {
        line-height: 1.4em;
      }
      paper-textarea {
        --paper-input-container: {
          padding: 0 0 1em 0;
        };
        --paper-input-container-label: {
          color: var(--secondary-text-color);
        };
        --paper-input-container-color: var(--secondary-background-color);
        --paper-input-container-focus-color: var(--anchor-color);
      }

      paper-button {
        transition:
        font-size: 14px;
        margin-top: 1em;
        background-color: var(--secondary-background-color);
        color: var(--primary-text-color);
        --paper-button-ink-color: var(--anchor-hover-color);
      }
      paper-button:hover,
      paper-button[active] {
        color: var(--primary-background-color);
        background-color: var(--anchor-color);
      }
      marked-github-element {
        margin-top: 16px;
        min-height: 50px;
      }
    </style>

    <paper-textarea hidden$="[[!_hidePreview]]" label="[[label]]" value="{{markdown}}"></paper-textarea>
    <marked-github-element hidden$="[[_hidePreview]]" markdown="[[markdown]]" project="[[project]]"></marked-github-element>
    <paper-button toggles raised hidden$="[[disabled]]" active="{{_previewToggle}}">[[_toggleText]]</paper-button>
  </template>
  <script>
    Polymer({
      is: 'markdown-input',
      properties: {
        project: Object,
        disabled: {
          type: Boolean,
          value: false
        },
        markdown: {
          type: String,
          notify: true
        },
        label: String,
        _previewToggle: Boolean,
        _hidePreview: {
          type: Boolean,
          computed: '_getHidePreview(_previewToggle, disabled)'
        },
        _toggleText: {
          type: String,
          computed: '_getToggleText(_previewToggle)'
        }
      },
      _getHidePreview: function(previewToggle, disabled) {
        var shouldBeHidden = !disabled && !previewToggle;
        this.toggleClass('noPreview', shouldBeHidden);
        return shouldBeHidden;
      },
      _getToggleText: function(active) {
        if (active) {
          return 'Edit';
        } else {
          return 'Preview';
        }
      }
    });
  </script>
</dom-module>
