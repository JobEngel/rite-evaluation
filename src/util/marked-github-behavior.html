<script>
MarkedGithubBehavior = {
  parseMarkdown: function(owner, name) {
    var githublink = '<a href="https://www.github.com/';

    function toLink(url, text) {
      return githublink + url + '" target="_blank">' + text + '</a>';
    }

    var replacers = [
      // Substitute issue references #1234
      {
        regex: /&?#(\d+)/g,
        callback: function(match, digits) {
          // Character was escaped, we should modify these numbers
          if (match.charAt(0) === '&') {
            return match;
          }
          return toLink(owner + '/' + name + '/issues/' + digits, digits);
        }
      },
      // Substitute user name references @TimvdLippe
      {
        regex: /\@(\w+)/g,
        callback: function(match, username) {
          return toLink(username, match);
        }
      }
    ];

    return function(err, text) {
      for (var i = 0, l = replacers.length; i < l; i++) {
        var replacer = replacers[i];
        text = text.replace(replacer.regex, replacer.callback);
      }
      return text;
    };
  }
};
</script>
