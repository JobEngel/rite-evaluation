<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../pull-request/pull-request-page.html">
<link rel="import" href="project-pull-request-list-item.html">
<link rel="import" href="../list-items/preview-list.html">

<dom-module id="project-pull-requests">
  <template>
    <style>
      :host {
        display: block;
      }
      paper-toolbar {
        --paper-toolbar-color: var(--primary-text-color);
        --paper-toolbar-background: 0;
      }
      paper-dropdown-menu {
        --paper-input-container-input-color: var(--primary-text-color);
        --paper-input-container-underline-focus: {
          background-color: var(--primary-action-red);
        }
        --paper-menu-button-dropdown: {
          width: 200px;
        }
        --paper-input-container-label: {
          color: var(--primary-text-color);
        }
      }
      project-pull-request-list-item {
        width: 100%;
      }
      a {
        color: inherit;
      }
    </style>
    <preview-list hide-end-indicator>
      <template is="dom-repeat" items="[[_filter(pullrequests, status)]]" as="pr">
        <a href$="[[route.prefix]]/pulls/[[pr.id]]" tabindex="-1">
          <project-pull-request-list-item tabindex="0" pr="[[pr]]"
                show-status="[[_equals('All', status)]]" on-tap="choosePR"
                on-keydown="maybeSelectPR"></project-pull-request-list-item>
        </a>
      </template>
    </preview-list>
  </template>
  <script>
    Polymer({
      is: 'project-pull-requests',
      properties: {
        owner: String,
        name: String,
        route: Object,

        pullrequests: {
          type: Array,
          computed: '_getPullRequests(owner, name)'
        },
        status: {
          type: String,
          value: 'All'
        }
      },

      _getPullRequests: function(owner, name) {
        return [
          {
            cistatus: 'failed',
            title: 'My best PR',
            id: 25,
            owner: 'Tim van der Lippe',
            status: 'Under review',
            timeopened: 12341234,
            notification: false,
            reviewers: [
              {
                name: 'Thomas Smith',
                lgtm: true,
                profile: 'https://avatars0.githubusercontent.com/u/5946422?v=3&s=72'
              },
              {
                name: 'Eva Anker',
                lgtm: false,
                profile: 'https://avatars1.githubusercontent.com/u/5946438?v=3&s=72'
              }
            ]
          },
          {
            cistatus: 'passed',
            title: 'My first PR',
            id: 20,
            owner: 'Eva Anker',
            status: 'Under review',
            timeopened: 12341236,
            notification: true,
            reviewers: [
              {
                name: 'Tim van der Lippe',
                lgtm: false,
                profile: 'https://avatars1.githubusercontent.com/u/5948271?v=3&amp;s=72'
              },
              {
                name: 'Thomas Smith',
                lgtm: true,
                profile: 'https://avatars0.githubusercontent.com/u/5946422?v=3&s=72'
              }
            ]
          },
          {
            cistatus: 'passed',
            title: 'My first PR',
            id: 20,
            owner: 'Eva Anker',
            status: 'Under review',
            timeopened: 12341236,
            notification: true,
            reviewers: [
              {
                name: 'Tim van der Lippe',
                lgtm: false,
                profile: 'https://avatars1.githubusercontent.com/u/5948271?v=3&amp;s=72'
              },
              {
                name: 'Thomas Smith',
                lgtm: true,
                profile: 'https://avatars0.githubusercontent.com/u/5946422?v=3&s=72'
              }
            ]
          },
          {
            cistatus: 'failed',
            title: 'Fix all the things',
            id: 20,
            owner: 'Thomas Smith',
            status: 'Waiting for contributor',
            timeopened: 12341235,
            notification: false,
            reviewers: [
              {
                name: 'Tim van der Lippe',
                lgtm: true,
                profile: 'https://avatars1.githubusercontent.com/u/5948271?v=3&amp;s=72'
              },
              {
                name: 'Eva Anker',
                lgtm: false,
                profile: 'https://avatars1.githubusercontent.com/u/5946438?v=3&s=72'
              }
            ]
          },
          {
            cistatus: 'failed',
            title: 'Fix all the things',
            id: 20,
            owner: 'Thomas Smith',
            status: 'Waiting for contributor',
            timeopened: 12341235,
            notification: false,
            reviewers: [
              {
                name: 'Tim van der Lippe',
                lgtm: true,
                profile: 'https://avatars1.githubusercontent.com/u/5948271?v=3&amp;s=72'
              },
              {
                name: 'Eva Anker',
                lgtm: false,
                profile: 'https://avatars1.githubusercontent.com/u/5946438?v=3&s=72'
              }
            ]
          },
          {
            cistatus: 'failed',
            title: 'Fix all the things',
            id: 20,
            owner: 'Thomas Smith',
            status: 'Waiting for contributor',
            timeopened: 12341235,
            notification: false,
            reviewers: [
              {
                name: 'Tim van der Lippe',
                lgtm: true,
                profile: 'https://avatars1.githubusercontent.com/u/5948271?v=3&amp;s=72'
              },
              {
                name: 'Eva Anker',
                lgtm: false,
                profile: 'https://avatars1.githubusercontent.com/u/5946438?v=3&s=72'
              }
            ]
          },
          {
            cistatus: 'failed',
            title: 'Fix all the things',
            id: 20,
            owner: 'Thomas Smith',
            status: 'Waiting for contributor',
            timeopened: 12341235,
            notification: false,
            reviewers: [
              {
                name: 'Tim van der Lippe',
                lgtm: true,
                profile: 'https://avatars1.githubusercontent.com/u/5948271?v=3&amp;s=72'
              },
              {
                name: 'Eva Anker',
                lgtm: false,
                profile: 'https://avatars1.githubusercontent.com/u/5946438?v=3&s=72'
              }
            ]
          },
          {
            cistatus: 'failed',
            title: 'Fix all the things',
            id: 20,
            owner: 'Thomas Smith',
            status: 'Waiting for contributor',
            timeopened: 12341235,
            notification: false,
            reviewers: [
              {
                name: 'Tim van der Lippe',
                lgtm: true,
                profile: 'https://avatars1.githubusercontent.com/u/5948271?v=3&amp;s=72'
              },
              {
                name: 'Eva Anker',
                lgtm: false,
                profile: 'https://avatars1.githubusercontent.com/u/5946438?v=3&s=72'
              }
            ]
          },
          {
            cistatus: 'failed',
            title: 'Fix all the things',
            id: 20,
            owner: 'Thomas Smith',
            status: 'Waiting for contributor',
            timeopened: 12341235,
            notification: false,
            reviewers: [
              {
                name: 'Tim van der Lippe',
                lgtm: true,
                profile: 'https://avatars1.githubusercontent.com/u/5948271?v=3&amp;s=72'
              },
              {
                name: 'Eva Anker',
                lgtm: false,
                profile: 'https://avatars1.githubusercontent.com/u/5946438?v=3&s=72'
              }
            ]
          },
          {
            cistatus: 'failed',
            title: 'Fix all the things',
            id: 15,
            owner: 'Thomas Smith',
            status: 'Waiting for contributor',
            timeopened: 12341235,
            notification: false,
            reviewers: [
              {
                name: 'Tim van der Lippe',
                lgtm: true,
                profile: 'https://avatars1.githubusercontent.com/u/5948271?v=3&amp;s=72'
              },
              {
                name: 'Eva Anker',
                lgtm: false,
                profile: 'https://avatars1.githubusercontent.com/u/5946438?v=3&s=72'
              }
            ]
          }
        ];
      },

      _filter: function(pullrequests, status) {
        if (status === 'All') {
          return pullrequests
        }
        return pullrequests.filter(function(e) {
          return e.status === status;
        });
      },
      _equals: function(one, other) {
        return one === other;
      },
      _shouldBeAtTop: function(small) {
        return small ? 'bottom' : 'top';
      },
      _withOwnerOnSmall: function(small, name, owner) {
        return name + (small ? ' by ' + owner : '');
      },
      choosePR: function(e) {
        this.set('route.path', '/pulls/' + e.model.pr.id);
      },
      maybeSelectPR: function(e) {
        if (e.keyCode === 13) {
          this.choosePR(e);
        }
      },
      _has: function() {
        return Array.prototype.slice.call(arguments).reduce(function(prev, current) {
          return prev && !!current;
        }, true);
      },
    });
  </script>
</dom-module>
